# Implementation Plan: Fix Network Model Definition

**Branch**: `002-fix-network-model` | **Date**: 2025-10-31 | **Spec**: [`spec.md`](./spec.md)
**Input**: Feature specification from `/specs/002-fix-network-model/spec.md`

**Note**: This template is filled in by the `/speckit.plan` command. See `.specify/templates/commands/plan.md` for the execution workflow.

## Summary

Align the Go SDK network and port models with the `pb.NetworkInfo`, `NetCreateInput`, and `NetPort` Swagger definitions so that every field exposed by the VPS API is available to SDK consumers. Ensure the SDK continues to map service error payloads (`vpserr.ErrResponse`) into typed errors with preserved context. Update accompanying unit, contract, and integration tests to cover the expanded structures while ensuring existing operations remain untouched except for necessary serialization tag changes. After automated checks, perform manual validation via `curl` against the six network module operations (base URL/token supplied later) and compare outputs with SDK results to confirm parity with the live system.

## Technical Context

**Language/Version**: Go 1.21  
**Primary Dependencies**: Go standard library (`encoding/json`, `context`, `net/http`)  
**Storage**: N/A  
**Testing**: `go test` (unit, contract, integration suites under `models/vps` and `modules/vps`)  
**Target Platform**: Linux (dev container)  
**Project Type**: Go SDK library  
**Performance Goals**: No new performance targets; maintain current JSON marshal/unmarshal characteristics  
**Constraints**: Modify only `models/vps/networks` data structures (network + port) plus directly related test fixtures; ensure JSON tags match Swagger (camelCase) and that shared error response handling continues to surface `vpserr.ErrResponse` details correctly. Do not alter module operation implementations beyond necessary struct tag exposure.  
**Scale/Scope**: Single SDK package update affecting network models and their tests.

## Constitution Check

*GATE: Must pass before Phase 0 research. Re-check after Phase 1 design.*

- **TDD mandatory**: Plan includes updating unit, contract, and integration tests first to reflect new fields before modifying model code.
- **Public API shape**: Changes limited to model structs exposed through existing client methods; no raw HTTP exposure introduced.
- **Minimal dependencies**: No new dependencies proposed; continue using Go standard library only.
- **Versioning & migration**: Adding fields is backwards-compatible (PATCH release); migration notes will highlight new accessible fields.
- **Observability & security**: Model-only changes do not affect logging or secret handling; existing safeguards remain intact.

Constitution Gate Status: ✅ Pass

## Project Structure

### Documentation (this feature)

```text
specs/002-fix-network-model/
├── plan.md
├── research.md
├── data-model.md
├── quickstart.md
├── contracts/
└── tasks.md  # generated by /speckit.tasks
```

### Source Code (repository root)

```text
models/
└── vps/
    └── networks/
        ├── network.go
        └── ports.go

modules/
└── vps/
    └── networks/
        ├── client.go
        ├── ports.go
        └── test/

internal/
└── http/
    └── client.go

tests (per package)
└── go test under models/vps/networks and modules/vps/networks
```

**Structure Decision**: Operate within existing Go SDK layout—primary changes in `models/vps/networks`, with test suites residing alongside models and module clients.

## Complexity Tracking

No constitution violations identified; tracking table not required.

## Constitution Re-Check (Post Design)

- Design artifacts (research, data-model, contracts, quickstart) stay within model-update scope.
- No additional dependencies or API surface changes introduced beyond planned struct updates.
- Test-first approach still feasible: expand fixtures and assertions prior to code updates.
- Verification MUST include running `make check` to execute linting and test suites end-to-end.
- Post-test validation MUST execute the six network module operations via `curl` against the real environment (using provided base URL/token) and compare responses with SDK calls.

Status: ✅ Pass
